#!/usr/bin/env python3
"""
Visualisation du flux dÃ©cisionnel du robot de trading
"""

def afficher_flux_decisionnel():
    print("=" * 80)
    print("FLUX DÃ‰CISIONNEL DU ROBOT DE TRADING")
    print("=" * 80)
    
    print("\nğŸ”„ BOUCLE PRINCIPALE (toutes les 60 secondes):")
    print("   â†“")
    
    print("\n1ï¸âƒ£  VÃ‰RIFICATION DES POSITIONS EXISTANTES")
    print("   â”œâ”€â”€ Scan de toutes les positions ouvertes")
    print("   â”œâ”€â”€ VÃ©rification si elles existent encore dans MT5")
    print("   â”œâ”€â”€ Suppression du suivi si positions fermÃ©es")
    print("   â””â”€â”€ Logging du profit des positions actives")
    print("   â†“")
    
    print("\n2ï¸âƒ£  PARCOURS DES SYMBOLES (Boom 300, 600, 900, Crash 1000)")
    print("   â†“")
    
    print("\n3ï¸âƒ£  OBTENTION DU SIGNAL IA")
    print("   â”œâ”€â”€ Appel API: GET https://kolatradebot.onrender.com/predict/{symbol}")
    print("   â”œâ”€â”€ RÃ©ponse JSON avec:")
    print("   â”‚   â”œâ”€â”€ direction: 'UP' ou 'DOWN'")
    print("   â”‚   â”œâ”€â”€ confidence: 0.0 - 1.0 (ex: 0.96 = 96%)")
    print("   â”‚   â”œâ”€â”€ analysis: trend_strength, volatility, volume, rsi, macd")
    print("   â”‚   â””â”€â”€ source: 'render_api' ou 'fallback'")
    print("   â†“")
    
    print("\n4ï¸âƒ£  FILTRE DE CONFIANCE")
    print("   â”œâ”€â”€ IF confidence < 70%:")
    print("   â”‚   â”œâ”€â”€ âŒ IGNORE le signal")
    print("   â”‚   â””â”€â”€ ğŸ“ Log: 'Confiance trop faible: X% < 70%'")
    print("   â”œâ”€â”€ ELSE (confidence >= 70%):")
    print("   â”‚   â””â”€â”€ âœ… CONTINUE vers validation")
    print("   â†“")
    
    print("\n5ï¸âƒ£  VALIDATION DU SIGNAL")
    print("   â”œâ”€â”€ IF direction != 'BUY' AND direction != 'SELL':")
    print("   â”‚   â”œâ”€â”€ âŒ IGNORE le signal")
    print("   â”‚   â””â”€â”€ ğŸ“ Log: 'Pas de signal trade: NEUTRAL'")
    print("   â”œâ”€â”€ ELSE:")
    print("   â”‚   â””â”€â”€ âœ… CONTINUE vers position check")
    print("   â†“")
    
    print("\n6ï¸âƒ£  VÃ‰RIFICATION POSITION EXISTANTE")
    print("   â”œâ”€â”€ IF position dÃ©jÃ  ouverte sur ce symbole:")
    print("   â”‚   â”œâ”€â”€ âŒ IGNORE le signal")
    print("   â”‚   â””â”€â”€ ğŸ“ Log: 'Position existante, ignore'")
    print("   â”œâ”€â”€ ELSE (pas de position):")
    print("   â”‚   â””â”€â”€ âœ… CONTINUE vers exÃ©cution")
    print("   â†“")
    
    print("\n7ï¸âƒ£  PRÃ‰PARATION DE L'ORDRE")
    print("   â”œâ”€â”€ RÃ©cupÃ©ration infos symbole (volume min/max, point, digits)")
    print("   â”œâ”€â”€ RÃ©cupÃ©ration tick actuel (bid/ask)")
    print("   â”œâ”€â”€ Calcul SL/TP selon symbole:")
    print("   â”‚   â”œâ”€â”€ Boom 300: SL=2000pts, TP=4000pts")
    print("   â”‚   â”œâ”€â”€ Boom 600: SL=1800pts, TP=3600pts")
    print("   â”‚   â”œâ”€â”€ Boom 900: SL=1500pts, TP=3000pts")
    print("   â”‚   â””â”€â”€ Crash 1000: SL=8000pts, TP=16000pts")
    print("   â”œâ”€â”€ Arrondi SL/TP Ã  3 dÃ©cimales (Boom/Crash)")
    print("   â””â”€â”€ Construction requÃªte MT5")
    print("   â†“")
    
    print("\n8ï¸âƒ£  EXÃ‰CUTION DE L'ORDRE")
    print("   â”œâ”€â”€ mt5.order_send(request)")
    print("   â”œâ”€â”€ IF result is None:")
    print("   â”‚   â”œâ”€â”€ âŒ ERREUR: 'mt5.order_send() returned None'")
    print("   â”‚   â””â”€â”€ ğŸ“ Log erreur + requÃªte complÃ¨te")
    print("   â”œâ”€â”€ IF result.retcode != TRADE_RETCODE_DONE:")
    print("   â”‚   â”œâ”€â”€ âŒ ORDRE REJETÃ‰")
    print("   â”‚   â”œâ”€â”€ ğŸ“ Log: code erreur + commentaire")
    print("   â”‚   â”œâ”€â”€ IF 'Invalid stops' dans commentaire:")
    print("   â”‚   â”‚   â”œâ”€â”€ ğŸ”„ ESSAI SANS SL/TP")
    print("   â”‚   â”‚   â”œâ”€â”€ Nouvelle requÃªte avec sl=0, tp=0")
    print("   â”‚   â”‚   â””â”€â”€ IF succÃ¨s: âœ… Ordre sans stops")
    print("   â”‚   â””â”€â”€ ELSE: âŒ Ã‰chec final")
    print("   â”œâ”€â”€ ELSE (succÃ¨s):")
    print("   â”‚   â”œâ”€â”€ âœ… ORDRE RÃ‰USSI!")
    print("   â”‚   â”œâ”€â”€ ğŸ“ Log: ticket, prix, volume")
    print("   â”‚   â”œâ”€â”€ ğŸ“‹ Enregistrement position dans self.positions")
    print("   â”‚   â””â”€â”€ ğŸ”„ Retour boucle principale")
    print("   â†“")
    
    print("\n" + "=" * 80)
    print("POINTS CLÃ‰S DU FLUX:")
    print("=" * 80)
    
    print("\nğŸ¯ SEUILS DÃ‰CISIONNELS:")
    print("   â€¢ Confiance minimale: 70%")
    print("   â€¢ Direction valide: BUY ou SELL uniquement")
    print("   â€¢ Position unique par symbole")
    print("   â€¢ Type filling: FOK (Fill or Kill)")
    
    print("\nâš¡ RYTHME:")
    print("   â€¢ Check toutes les 60 secondes")
    print("   â€¢ 4 symboles scannÃ©s = 1 signal toutes les 15 secondes max")
    print("   â€¢ Position tracking en temps rÃ©el")
    
    print("\nğŸ›¡ï¸ SÃ‰CURITÃ‰:")
    print("   â€¢ Volume fixe par symbole (0.2-0.5)")
    print("   â€¢ SL/TP trÃ¨s larges (Ã©vite 'Invalid stops')")
    print("   â€¢ Fallback sans SL/TP si nÃ©cessaire")
    print("   â€¢ Magic number unique (234000)")
    
    print("\nğŸ“Š LOGGING:")
    print("   â€¢ Tentatives d'ordres complÃ¨tes")
    print("   â€¢ Erreurs dÃ©taillÃ©es avec requÃªtes")
    print("   â€¢ Profits des positions actives")
    print("   â€¢ Confiance et direction des signaux")
    
    print("\n" + "=" * 80)
    print("EXEMPLE CONCRET:")
    print("=" * 80)
    
    print("\nğŸ“ˆ SCÃ‰NARIO RÃ‰USSI:")
    print("   1. Signal reÃ§u: Boom 300 Index, direction=UP, confidence=96%")
    print("   2. âœ… Confiance 96% >= 70% â†’ Continue")
    print("   3. âœ… Direction 'UP' â†’ Signal BUY")
    print("   4. âœ… Pas de position existante â†’ Continue")
    print("   5. ğŸ“Š Ask: 1980.273, Volume: 0.5")
    print("   6. ğŸ“ SL: 1978.273 (-2000pts), TP: 1984.273 (+4000pts)")
    print("   7. ğŸ“¤ Envoi requÃªte MT5 avec type_filling=FOK")
    print("   8. âœ… Ordre rÃ©ussi: Ticket 5543930557")
    print("   9. ğŸ“‹ Position enregistrÃ©e pour tracking")
    
    print("\nâŒ SCÃ‰NARIO REJETÃ‰:")
    print("   1. Signal reÃ§u: Boom 900 Index, direction=DOWN, confidence=63%")
    print("   2. âŒ Confiance 63% < 70% â†’ Signal ignorÃ©")
    print("   3. ğŸ“ Log: 'Confiance trop faible: 63.0% < 70.0%'")
    print("   4. ğŸ”„ Continue vers symbole suivant")

if __name__ == "__main__":
    afficher_flux_decisionnel()
